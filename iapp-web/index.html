<!DOCTYPE html>
<html>

<head>
    <title>iApp</title>
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
    <!-- SEO -->
    <!-- <meta name="Description" content="" />
    <meta name="Keywords" content="" /> -->
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="css/bootstrap-responsive.css">
    <link rel="stylesheet" type="text/css" href="css/docs.css">
    <link rel="stylesheet" type="text/css" href="css/masonry.css">
    <!--[if lt IE 9]>
		<script src="http://fineui.com/lib/html5shim/html5.js"></script>
	<![endif]-->
</head>

<body data-spy="scroll" data-target=".bs-docs-sidebar">
    <!-- 導覽列 -->
    <div class="navbar navbar-inverse navbar-fixed-top">
        <div class="navbar-inner">
            <div class="container">
                <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                    <span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar">
                    </span>
                </button>
                <a class="brand" href="index.html">Digital+</a>
                <div class="nav-collapse collapse">
                    <ul class="nav">
                        <li><a href="http://iapp-media.com/test/">iApp</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <!-- <div class="jumbotron subhead">
        <div class="container">
            <h1>
                典型案例</h1>
            <p class="lead">
                基于 FineUI 的经典案例。</p>
        </div>
    </div> -->
    <div class="container">
        <!-- 瀑布流 -->
        <div id="masonry" class="container-fluid">
        </div>
        <div id="masonry_ghost" class="hide">
            <div class="thumbnail">
                <div class="imgs">
                    <input type="hidden" value="picture1.jpg">
                </div>
                <div class="caption">
                    <div class="title">test1</div>
                    <div class="content">
                    </div>
                    <div class="author">
                        by <a target="_blank" href="http://fineui.com/bbs/home.php?mod=space&uid=2426">小小生</a>
                    </div>
                </div>
            </div>
            <div class="thumbnail">
                <div class="imgs">
                    <input type="hidden" value="picture2.jpg">
                </div>
                <div class="caption">
                    <div class="title">test2</div>
                    <div class="content">
                    </div>
                    <div class="author">
                        by <a target="_blank" href="http://fineui.com/bbs/home.php?mod=space&uid=227">wangdotnet</a>
                    </div>
                </div>
            </div>
            <div class="thumbnail">
                <div class="imgs">
                    <input type="hidden" value="picture3.jpg">
                </div>
                <div class="caption">
                    <div class="title">test3</div>
                    <div class="content">
                    </div>
                    <div class="author">
                        by <a target="_blank" href="http://fineui.com/bbs/home.php?mod=space&uid=672">拓梦·D</a>
                    </div>
                </div>
            </div>
            <div class="thumbnail">
                <div class="imgs">
                    <input type="hidden" value="picture4.jpg">
                </div>
                <div class="caption">
                    <div class="title">test4</div>
                    <div class="content">
                    </div>
                    <div class="author">
                        by <a target="_blank" href="http://fineui.com/bbs/home.php?mod=space&uid=160">☆幻~精灵</a>
                    </div>
                </div>
            </div>
            <div class="thumbnail">
                <div class="imgs">
                    <input type="hidden" value="picture5.jpg">
                </div>
                <div class="caption">
                    <div class="title">test5</div>
                    <div class="content">
                    </div>
                    <div class="author">
                        by <a target="_blank" href="http://fineui.com/bbs/home.php?mod=space&uid=970">蓝色天空</a>
                    </div>
                </div>
            </div>
            <div class="thumbnail">
                <div class="imgs">
                    <input type="hidden" value="picture6.jpg">
                </div>
                <div class="caption">
                    <div class="title">test6</div>
                    <div class="content">
                    </div>
                    <div class="author">
                        by <a target="_blank" href="http://fineui.com/bbs/home.php?mod=space&uid=552">孤独的过客</a>
                    </div>
                </div>
            </div>
            <div class="thumbnail">
                <div class="imgs">
                    <input type="hidden" value="miniApp.jpg">
                </div>
                <div class="caption">
                    <div class="title">test7</div>
                    <div class="content">
                    </div>
                    <div class="author">
                        by <a target="_blank" href="http://fineui.com/bbs/home.php?mod=space&uid=1431">CoolHots</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- 頁尾 -->
    <!-- <footer class="footer">
        <div class="container">
            <p class="pull-right"><a href="#">回到顶部</a></p>
            <ul class="footer-links">
                <li><a href="index.html">back</a>
            </ul>
        </div>
    </footer> -->
    <script src="js/jquery-1.8.2.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/main.js"></script>
    <script src="js/masonry.pkgd.min.js"></script>
    <script src="js/imagesloaded.pkgd.min.js"></script>
    <script>
    $(function() {

        var ghostNode = $('#masonry_ghost').find('.thumbnail'),
            i, ghostIndexArray = [];
        var ghostCount = ghostNode.length;
        for (i = 0; i < ghostCount; i++) {
            ghostIndexArray[i] = i;
        }
        ghostIndexArray.sort(function(a, b) {
            if (Math.random() > 0.5) {
                return a - b;
            } else {
                return b - a;
            }
        });

        var currentIndex = 0;
        var masNode = $('#masonry');
        var imagesLoading = false;


        function getNewItems() {
            var newItemContainer = $('<div/>');
            for (var i = 0; i < 6; i++) {
                if (currentIndex < ghostCount) {
                    newItemContainer.append(ghostNode.get(ghostIndexArray[currentIndex]));
                    currentIndex++;
                }
            }
            return newItemContainer.find('.thumbnail');
        }

        function processNewItems(items) {
            items.each(function() {
                var $this = $(this);
                var imgsNode = $this.find('.imgs');
                var title = $this.find('.title').text();
                var author = $this.find('.author').text();
                title += '&nbsp;&nbsp;(' + author + ')';
                var lightboxName = 'lightbox_'; // + imgNames[0];

                var imgNames = imgsNode.find('input[type=hidden]').val().split(',');
                $.each(imgNames, function(index, item) {
                    imgsNode.append('<a href="http://fineui.com/case/images/large/' + item + '" data-lightbox="' + lightboxName + '" title="' + title + '"><img src="images/' + item + '" /></a>');
                });
            });
        }

        function initMasonry() {
            var items = getNewItems().css('opacity', 0);
            processNewItems(items);
            masNode.append(items);

            imagesLoading = true;
            items.imagesLoaded(function() {
                imagesLoading = false;
                items.css('opacity', 1);
                masNode.masonry({
                    itemSelector: '.thumbnail',
                    isFitWidth: true
                });
            });
        }


        function appendToMasonry() {
            var items = getNewItems().css('opacity', 0);
            processNewItems(items);
            masNode.append(items);

            imagesLoading = true;
            items.imagesLoaded(function() {
                imagesLoading = false;
                items.css('opacity', 1);
                masNode.masonry('appended', items);
            });
        }


        initMasonry();

        $(window).scroll(function() {

            if ($(document).height() - $(window).height() - $(document).scrollTop() < 10) {

                if (!imagesLoading) {
                    appendToMasonry();
                }

            }

        });


    });
    </script>
</body>

</html>
